<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="sunyoung-dev">
    <meta name="keywords"  content="dev, programming, sunyoung">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Understanding Java G1GC - Part1 - output">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="Heap 메모리 구조

">
    
    <meta property="article:published_time" content="2019-08-18T00:00:00Z">
    
    
    <meta property="article:author" content="sunyoung.dev">
    
    
    <meta property="article:tag" content="자바">
    
    
    <meta property="og:image" content="http://localhost:4000">
    <meta property="og:url" content="http://localhost:4000/2019/08/18/java-g1gc-part1/">
    <meta property="og:site_name" content="output">
    
    <title>Understanding Java G1GC - Part1 - output</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2019/08/18/java-g1gc-part1/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">output</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
                    
                    
                    <li>
                        <a href="/archive/">Archive</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/in-post/garbage.jpg');
        background: ;
    }

    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=%EC%9E%90%EB%B0%94" title="자바">자바</a>
                        
                    </div>
                    <h1>Understanding Java G1GC - Part1</h1>
                    
                    <h2 class="subheading">G1GC의 개념과 용어</h2>
                    <span class="meta">Posted by sunyoung.dev on August 18, 2019</span>
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h3 id="heap-메모리-구조">Heap 메모리 구조</h3>

<p>이전의 GC와는 다르게 Heap 영역을 (young, old) Generation 으로 분할하지 않는다. Heap 전체를 일정한 크기로 쪼개서 각 조각별로 메모리를 관리한다. 이때 쪼개진 메모리 조각을 region이라고 부른다.  region의 크기는 작게는 1MB 부터 32MB 까지 설정된다. 보통 Heap이 약 2000개로 나눠지도록 region의 크기가 정해진다. 예를 들어 메모리의 크기가 8GB 라면 region의 크기는 8GB/2000 = 4GB가 된다.</p>

<h3 id="region">Region</h3>

<p>Old, Young Generation의 개념이 아예 사라진 것은 아니다. 메모리의 크기를 정해두고 이 영역은 young generation, 나머지 메모리는 old generation이라고 정해두지 않을 뿐이지 객체의 age에 따른 generation 개념은 G1GC에도 있다. region 하나하나가 동적으로 young region이 되었다가 old region이 되었다가 한다.</p>

<p><img src="/img/in-post/gc-region.jpg" alt="" /></p>

<blockquote>
  <p>Eden : 새로 생성한 대부분의 객체가 저장되는 곳</p>

  <p>Survivor : Eden 영역에서 GC 발생 후 살아남은 객체가 이동하는 곳</p>

  <p>Old : Survivor 영역에서 GC 발생 후 계속 살아남은 객체가 이동하는 곳</p>

  <p>Humongous : region 크기의 50%가 넘는 큰 객체가 저장되는 곳</p>

  <p>Available/unused : 새로운 region이 될 수 있는, 아무것도 할당되지 않은 곳</p>
</blockquote>

<p>Eden, Survivor region을 통틀어 Young Generation이라고 하고 Old region의 집합을 Old Generation이라고 한다. 각 region은 GC가 일어남에 따라서 old region이 되기도, eden region이 되기도, survivor region이 되기도 한다.</p>

<p>GC가 일어날 때는 각 region 별로 GC가 발생하는데 GC가 발생 후 살아남은 live object는 다른 region으로 copy 한다. garbage object는 region에 남고, 그 region은 다른 객체가 할당될 수 있도록 available region으로 바뀐다.</p>

<p>region 별로 GC를 하면 장점이 있다.</p>

<ol>
  <li>
    <p>Heap 전체를 한꺼번에 정리하는 것보다 region 별로 concurrent 하게 collection을 하면 stop-the-world pause time을 줄일 수 있다.</p>
  </li>
  <li>
    <p>GC 이후 live object가 새로운 region으로 옮겨갈 때 한 곳에 차곡차곡 쌓을 수 있다. compaction 작업을 따로 하지 않아도 compaction을 한 효과를 볼 수 있는 것이다. 다른 GC 방식에서는 compaction 작업을 위해 전체 Heap을 스캔해야 하는 걸 생각해보면 효율적이다.</p>
  </li>
</ol>

<h3 id="young-gc">Young GC</h3>

<p>Young GC는 eden region이 일정 갯수 이상 할당되었을 때 발생한다. Eden 영역의 크기는 정해져 있지 않고 GC가 일어남에 따라 변하는데 이 크기가 가득 차면 Young GC를 수행한다.</p>

<p>Young GC는 stop-the-world pause를 발생시키고 multi-thread로 동작한다. Young GC가 일어날 때는 Heap 영역의 모든 Young generation (Eden region, Survivor region의 집합)이 전부 collectioin의 대상이 된다.</p>

<p>Age가 되지 않은 객체는 survivor영역으로 copy하고 promotion 대상 객체는 Old Generation Region으로 copy한다. 만약 survivor 영역이나 old 영역에 copy할 자리가 없다면 available region을 하나 새로 할당해서 사용한다. GC 대상 Young Generation Region은 garbage로 간주하고 Region 단위로 할당을 해지한다.</p>

<h3 id="old-gc">Old GC</h3>

<p>Old 영역의 GC는 자바 heap 메모리의 일정 퍼센트 이상이 사용 중일 때 initial-mark가 수행되면서 발생한다. CMS는 Old 영역의 크기가 일정 퍼센트 이상 사용 중일 때 Old GC가 발생하는 반면, G1GC는 전체 Heap 크기에 의해 발생함을 주의한다. 기본 퍼센트는 45%이고 <code class="highlighter-rouge">-XX:InitiatingHeapOccupancyPercent</code> 옵션을 통해 원하는 값을 설정할 수 있다.</p>

<p>Old 영역 GC가 수행될 때는 항상 Young GC가 수행될 때 같이 수행된다. Old 영역의 GC의 시작인 initial-mark 단계가 young gc가 수행될 때 같이 수행되기 때문이다.</p>

<h3 id="mixed-gc">Mixed GC</h3>

<p>G1GC에서는 Old GC가 Young GC가 일어날 때 같이 수행되는데 이렇게 Young GC와 Old GC가 동시에 수행되는 작업을 Mixed GC라고 한다.</p>

<h3 id="full-gc">Full GC</h3>

<p>Heap에 더이상 할당할 메모리가 없을 때 full GC가 일어난다. full GC는 자바 Heap 전체에 대한 Compaction 작업을 수행한다. 이 때 발생하는 Compaction은 Serial GC에서 수행하는 Compaction과 같이 Single Thread로 수행되며, 무지 느리다. 그래서 G1GC에서는 full gc가 일어나지 않는 것을 전제로 한다.</p>

<p>Humongous region은 연속된 메모리를 사용하는데 Humongous region이 사용할 연속된 메모리가 확보되지 않을 때에도 full gc가 일어난다.</p>

<h2 id="참고">참고</h2>

<p><a href="https://docs.oracle.com/javase/9/gctuning/garbage-first-garbage-collector.htm#JSGCT-GUID-F1BE86FA-3EDC-4D4F-BDB4-4B044AD83180">Oracle : Garbage first garbage collector</a></p>

<p><a href="https://plumbr.io/handbook/garbage-collection-algorithms-implementations/g1">Plumbr : Garbage collection algorithms implementation</a></p>

<p><a href="https://initproc.tistory.com/entry/G1-Garbage-Collection">Blog : G1 Garbage Collection</a></p>

<p><a href="https://logonjava.blogspot.com/2015/08/java-g1-gc-full-gc.html">Blog : Java G1GC full gc</a></p>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/04/27/call-by-value/" data-toggle="tooltip" data-placement="top" title="Java의 매개변수 전달방식">
                        Previous<br>
                        <span>Java의 매개변수 전달방식</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2019/08/19/java-g1gc-part2/" data-toggle="tooltip" data-placement="top" title="Understanding Java G1GC - Part2">
                        Next<br>
                        <span>Understanding Java G1GC - Part2</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        </a>
        
        
                <a data-sort="0000" 
                    href="/archive/?tag=%EC%9E%90%EB%B0%94"
                    title="자바"
                    rel="3">자바
    </div>
</section>


                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->






<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "sunyoung_dev";
    var disqus_identifier = "/2019/08/18/java-g1gc-part1";
    var disqus_url = "http://localhost:4000/2019/08/18/java-g1gc-part1/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  
  
  
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; output 2019
                    <br>
                    Powered by <a href="http://huangxuan.me">Hux Blog</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->





<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-144682762-1';
    var _gaDomain = 'sunyoung-dev.github.io';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->



</body>

</html>
